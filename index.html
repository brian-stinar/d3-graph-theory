<!DOCTYPE html>
<html>
  <head>    
    <style type="text/css">
        .node {
            fill: #ff0000;
            stroke: #fff;
            stroke-width: 1.5px;
        }

        .link {
            stroke: #aaa;
            stroke-width: 1.5px;
        }
    </style>
    <title></title>
    <script type="text/javascript" src="js/libs/d3/d3.v3.min.js"></script>
    <script type="text/javascript" src="js/libs/jquery/jquery.js"></script>
    <script src="http://jquery-xml2json-plugin.googlecode.com/svn/trunk/jquery.xml2json.js"></script>
    <script type="text/javascript" src="js/buildGraph.js"></script>
    <script type="text/javascript" src="js/graphTheory.js"></script>

  </head>
  <body>
      
      <script type="text/javascript">
        
        function buildJsonEdges(jsonRepresentation)
        {
            var edges = [];
               
            for (edgeNumber in jsonRepresentation.edgeData)
            {
                edges[edgeNumber] = {}
                edges[edgeNumber]['source'] = jsonRepresentation.edgeData[edgeNumber].fromNode;
                edges[edgeNumber]['target'] = jsonRepresentation.edgeData[edgeNumber].toNode;
            }        
            return edges;
        }
        
        
        function buildJsonNodes(jsonRepresentation)
        {
            var nodes = [];
            
            for (nodeNumber in jsonRepresentation.nodeData)
            {
                nodes[nodeNumber] = {};
                nodes[nodeNumber].name = jsonRepresentation.nodeData[nodeNumber].nodeId;
                // There will need to be a reckoning between D3 names and our names. 
                // These 'names' are more like our IDs.
                nodes[nodeNumber].description = jsonRepresentation.nodeData[nodeNumber].description;
                nodes[nodeNumber].type = jsonRepresentation.nodeData[nodeNumber].type;
                
                //console.info(jsonRepresentation.nodeData[nodeNumber]);
            }
            return nodes;
        }
        
        
        $(document).ready
        (
            function ()
            {
                var usingXml = false;
                var data = {};
                
                if (usingXml)
                {
                    $.get('114.xml', function(d){

                        var jsonRepresentation = $.xml2json(d);
                        
                        data["edges"] = buildJsonEdges(jsonRepresentation);
                        data["nodes"] = buildJsonNodes(jsonRepresentation);
                    });
                }
               
                else
                {
                    data = generateDoubleBox();
                }

                var graphTheory = d3.graphTheory(data["nodes"], data["edges"]);
                var source = data["nodes"][2];
                source["type"] = "source";
                graphTheory.dijkstras(source);
                console.log("source['name'] = ");
                console.log(source['name']);
                
                buildGraph(data);

            }
        );

        
        function generateDoubleBox()
        {
            var data = generateSixRingGraph();
            data["edges"].push({"source" : "6", "target" : "3", "type" : "unvisited"});
            return data;
        }
        
        
        function generateSixRingGraph()
        {
            var data = {};
            data["nodes"] = [{"name":"0"}, {"name":"1"}, {"name":"2"}, {"name":"3"}, {"name":"4"}, {"name":"5"}, {"name":"6"}];
            data["edges"] =  
            [
                {"source" : "1", "target" : "2"}, {"source" : "2", "target" : "3"}, {"source" : "3", "target" : "4"},
                {"source" : "4", "target" : "5"}, {"source" : "5", "target" : "6"}, {"source" : "6", "target" : "1"}
            ];
            
            for (node in data["nodes"])
            {
                data["nodes"][node]["type"] = "unvisited";
            }
            
            return data;
        }
        
      </script>
      
  </body>
</html>